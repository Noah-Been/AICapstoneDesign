# 네이버 크롤링 정리 — 2025-10-16 (KST)

## 1) 개요
- 작업 범위: WSL DNS 안정화, 네이버 뉴스/블로그 수집 재시도, 수집 파이프라인 개선(빈 파일 처리, 플래그 버그 수정), 커버리지 점검
- 핵심 변경:
  - 빈 결과 시 파일 미생성 + 기존 0바이트 파일 자동 삭제
  - `--require-both` 플래그 동작 수정(옵션 미지정 시 완화 적용)
  - 러너 스크립트에서 사전/라운드 후 0바이트 파일 정리, 수집 범위 일부 완화(days/per-query)

## 2) 환경 메모(WSL DNS)
- 목적: 네이버 OpenAPI 호출 시 DNS 오류 제거
- 요약 절차:
  - `/etc/wsl.conf`에 `[network]\ngenerateResolvConf=false` 설정
  - `/etc/resolv.conf`를 수동 작성(예: `61.41.153.2`, `1.214.68.2`, `1.1.1.1`, `8.8.8.8`)
  - 필요 시 `sudo chattr +i /etc/resolv.conf`로 잠금(선택)
  - PowerShell `wsl --shutdown`으로 영구 반영(여유 있을 때)

## 3) 코드 변경 요약
- 수집기(빈 파일 방지/정리)
  - `빅데이터캡디/mvp/apps/news_naver.py`
    - 빈 결과 시 기존 0바이트 파일 삭제 후 반환(파일 미생성)
    - `--require-both` 플래그 실제 동작하도록 수정
  - `빅데이터캡디/mvp/apps/blog_naver.py`
    - 빈 결과 시 기존 0바이트 파일 삭제 후 반환(파일 미생성)
    - `--require-both` 플래그 실제 동작하도록 수정
- 러너(사전/사후 정리 + 범위 완화)
  - `빅데이터캡디/mvp/apps/run_top_crawl.sh`
    - 라운드 시작 전/매 라운드 후 `*.jsonl` 0바이트 파일 일괄 삭제
    - 수집 파라미터: `--days 7`, `--per-query 80` (뉴스/블로그 공통), `--require-both` 제거(완화)

## 4) 스냅샷 결과 요약(2025-10-16)
- 대상 Top10: 178320, 204270, 160190, 060280, 042700, 034020, 131970, 399720, 011070, 101490
- 커버리지(뉴스/블로그 건수):
  - 178320: 0 / 0
  - 204270: 1 / 1
  - 160190: 5 / 2
  - 060280: 1 / 1
  - 042700: 5 / 1
  - 034020: 7 / 0
  - 131970: 7 / 1
  - 399720: 0 / 1
  - 011070: 1 / 0
  - 101490: 2 / 0
- 샘플 하이라이트(제목 | 출처 도메인):
  - 034020: 두산에너빌리티 신고가 관련 2건 | edaily.co.kr
  - 131970: 반도체 테스트 장비 구매 2건 | edaily.co.kr, dealsite.co.kr
  - 042700: HBM 후공정 모멘텀 관련 2건 | widedaily.com, cbci.co.kr
  - 160190: 단기 수급/로봇 테마 2건 | pointdaily.co.kr, widedaily.com

## 5) 파일 경로
- TopN: `빅데이터캡디/mvp/data/snapshots/2025-10-16/topN.json`
- 뉴스: `빅데이터캡디/mvp/data/snapshots/2025-10-16/news_strict/{티커}.jsonl`
- 블로그: `빅데이터캡디/mvp/data/snapshots/2025-10-16/blogs_strict/{티커}.jsonl`
- 신호 전체: `빅데이터캡디/mvp/data/snapshots/2025-10-16/rank_signals.jsonl`

## 6) 실행/재현
- 준비: `source ~/.secrets/naver_env.sh`; `export SNAPSHOT_DATE=$(TZ=Asia/Seoul date +%F)`
- 러너: `빅데이터캡디/mvp/apps/run_top_crawl.sh 12 60`
  - 라운드 전/후 자동으로 0바이트 파일 정리
- 수동 정리(선택): `find 빅데이터캡디/mvp/data/snapshots/$SNAPSHOT_DATE -type f -name '*.jsonl' -size 0 -delete`

## 7) 다음 단계 제안
- 카드 요약 생성: TopN 대상 뉴스/블로그 1–2건씩 2–3문장 요약 + 링크(마크다운/HTML)
- 커버리지 튜닝: 블로그 `--days`/`--per-query` 미세조정, 도메인 화이트리스트 보완
- 운영 자동화: 크론(새벽 수집 → 아침 카드 생성/대시보드 반영)

(작성: 2025-10-16 19:45 KST)
